import{Q as Ve,o_ as vt,a8 as c,a9 as p,aa as O,a3 as ht,A as Nt,fN as Ie,jq as ce,b3 as Z,tx as pe,ty as $n,tz as Sn,cA as C,ed as Ht,dS as jt,dy as Tn,dP as Ae,dD as Mn,dA as On,iV as ue,bD as mt,tA as Pn,bI as qt,dj as ze,tB as En,y as Bt,ek as Cn,b8 as Rn,kf as kn,tC as Ue,b7 as Vn,b6 as In,lA as An,kb as ee,e9 as Fe,dO as zn,dR as Mt,r_ as Un,aY as Ge,tD as Fn,oy as Ct,oz as Gn,eL as Hn,kl as He,tn as ut,hs as W,tE as Dn,tF as F,w as Zn,cP as ne,fG as Ln,dd as Wn,bv as H,tG as de,c7 as Tt,bC as X,B as Nn,aR as _t,fo as jn,bE as Ot,az as he,iu as De,l7 as Yt,at as Ze,tH as Le,bc as We,iq as Xt,fO as Ne,tI as qn,lv as Bn,mv as Yn,rt as Xn,kk as Kn,lb as it,oA as me,tJ as Qn,tK as Jn,hk as ti,pE as ei,pF as ge,dB as ni,hw as ye,lk as fe,tv as ve}from"./index-CQBquChn.js";import{r as N,V as ii,c as oi,j as si,m as Rt,a as ri,R as ai,b as li,d as ci,O as pi}from"./automaticLengthMeasurementUtils-BwOZgQvT.js";import{distance as ui,simplify as di}from"./geometryEngine-CGiSmtFk.js";import{R as hi,L as mi}from"./quat-BeEDDB2b.js";import{e as _e}from"./quatf64-aQ5IuZRd.js";import{a as gi,b as yi,E as je,j as qe,p as Pt,u as fi,m as Be}from"./elevationInfoUtils-BVGJLyt1.js";import{h as gt,k as vi,R as _i,y as Ye,F as Xe,Q as xi,w as wi,u as Ke,E as Kt,e as Qt,P as bi,p as $i,c as Si,t as Ti,d as Mi,f as Oi,g as Pi}from"./SnappingContext-CAc-ADuh.js";import{c as J,H as ie,K as Ei,X as Q,Y as Qe,G as Ci,U as K,Z as Je,_ as Ri,$ as tn,j as ki,M as Vi,a0 as Ii,g as Ai,a1 as zi,l as en,P as nn,a2 as Ui,O as Fi}from"./hitTestSelectUtils-DLsZRdQ2.js";import{t as xe}from"./memoize-DmxaQ-k8.js";import{c as Gi}from"./meshVertexSpaceUtils-BzNVEd-n.js";import{x as kt,k as Hi}from"./hydratedFeatures-7D0P_Q9Y.js";import{n as Vt,e as oe}from"./projectVectorToVector-P746t1f4.js";import{W as Di,K as It}from"./boundedPlane-B0v55TW0.js";import{t as ot}from"./plane-DQgnaDZz.js";function pt(e,t){return e===t||e!=null&&t!=null&&Ve(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Dt(e,t,n){return e===t||e!=null&&t!=null&&Ve(e.spatialReference,t.spatialReference)&&vt(e.x,t.x,n)&&vt(e.y,t.y,n)&&vt(e.z??0,t.z??0,n)&&vt(e.m??0,t.m??0,n)}var M;(function(e){e[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone"})(M||(M={}));var V;(function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"})(V||(V={}));const At={[V.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[V.UndoInvalidError]:"There are no items to Undo",[V.RedoInvalidError]:"There are no items to Redo",[V.ApplyInvalidError]:"Cannot apply an item that is already applied"};let st=class extends Error{constructor(){super(At[V.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},Jt=class extends Error{constructor(){super(At[V.UndoInvalidError]),this.type="undo-redo-undo-error"}},we=class extends Error{constructor(){super(At[V.RedoInvalidError]),this.type="undo-redo-redo-error"}},Zi=class extends Error{constructor(){super(At[V.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var A;(function(e){e[e.Apply=0]="Apply",e[e.Undo=1]="Undo",e[e.Redo=2]="Redo"})(A||(A={}));let xt=class extends ht{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=M.NeverApplied}get canUndo(){return this.status===M.Applied}get canRedo(){return this.status===M.Undone}async executeUndoRedoOperation(t){switch(t){case A.Apply:if(this.status!==M.NeverApplied)throw new Zi;return await this.apply(),void(this.status=M.Applied);case A.Undo:if(this.status!==M.Applied)throw new Jt;return await this.undo(),void(this.status=M.Undone);case A.Redo:if(this.status!==M.Undone)throw new Jt;return await this.redo(),void(this.status=M.Applied)}}};c([p()],xt.prototype,"name",void 0),c([p()],xt.prototype,"tag",void 0),xt=c([O("esri.undoredo.UndoableOperation")],xt);let R=class extends ht{constructor(){super(...arguments),this._stack=new Nt,this._stackPosition=-1,this._updatingHandles=new Ie}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new Jt;if(this.updating)throw new st;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(A.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new we;if(this.updating)throw new st;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new we;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(A.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new st;await this._updatingHandles.addPromise((async()=>{e.status===M.NeverApplied&&await e.executeUndoRedoOperation(A.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(t=>t.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new st;await this._updatingHandles.addPromise((async()=>{e.status===M.NeverApplied&&await e.executeUndoRedoOperation(A.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await ce(()=>!this.updating);const n=new Nt;for(let i=0;i<this._stack.length;i++){const o=this._stack.getItemAt(i);o&&(o.tag===e?(o.destroy(),i===this._stackPosition&&(this._stackPosition=n.length-1)):n.push(o))}this._stack=n,this._stackPosition>n.length-1&&(this._stackPosition=n.length-1)}async clear(e=!1){if(this.updating&&!e)throw new st;await ce(()=>!this.updating),this._drainStack()}};c([p()],R.prototype,"_stack",void 0),c([p()],R.prototype,"_stackPosition",void 0),c([p()],R.prototype,"updating",null),c([p({readOnly:!0})],R.prototype,"canUndo",null),c([p({readOnly:!0})],R.prototype,"hasUndo",null),c([p({readOnly:!0})],R.prototype,"canRedo",null),c([p({readOnly:!0})],R.prototype,"hasRedo",null),R=c([O("esri.UndoRedo")],R);let Li=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function Et(e,t,n=null){return n!=null?[e,t,n]:[e,t]}function b(e,t,n=null){return n!=null?{x:e,y:t,z:n}:{x:e,y:t}}let on=class{constructor(t){this.spatialReference=t}mapToLocalMultiple(t){return t.map(n=>this.mapToLocal(n)).filter(mt)}get doUnnormalization(){return!1}},Wi=class extends on{constructor(t,n,i=null){super(n),this._defaultZ=i,this.transform=pe(),this.transformInv=pe(),this.transform=$n(t),Sn(this.transformInv,this.transform)}makeMapPoint(t,n){return Et(t,n,this._defaultZ)}mapToLocal(t){return b(this.transform[0]*t[0]+this.transform[2]*t[1]+this.transform[4],this.transform[1]*t[0]+this.transform[3]*t[1]+this.transform[5])}localToMap(t){return Et(this.transformInv[0]*t.x+this.transformInv[2]*t.y+this.transformInv[4],this.transformInv[1]*t.x+this.transformInv[3]*t.y+this.transformInv[5],this._defaultZ)}},Ni=class extends on{constructor(t,n){super(t.spatialReference),this.view=t,this.defaultZ=null,this.pWS=C(),this.tangentFrameUpWS=C(),this.tangentFrameRightWS=C(),this.tangentFrameForwardWS=C(),this.localFrameRightWS=C(),this.localFrameUpWS=C(),this.worldToLocalTransform=_e(),this.localToWorldTransform=_e(),this.scale=1,this.scale=t.resolution,this.referenceMapPoint=n,this.defaultZ=n.hasZ?n.z:null;const i=t.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Ht.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Ht.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,Ht.Z,this.tangentFrameForwardWS);const o=C();jt(o,this.tangentFrameForwardWS,Tn(i,this.tangentFrameForwardWS)),Ae(this.localFrameRightWS,i,o),Mn(this.localFrameRightWS,this.localFrameRightWS),On(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),hi(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),mi(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(t,n){return Et(t,n,this.defaultZ)}mapToLocal(t){const n=C();this.view.renderCoordsHelper.toRenderCoords(new Z({x:t[0],y:t[1],spatialReference:this.spatialReference}),n),ue(n,n,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(n,new Z({spatialReference:this.view.spatialReference}));return i!=null?b(i.x/this.scale,i.y/this.scale):null}localToMap(t){const n=C();this.view.renderCoordsHelper.toRenderCoords(new Z({x:t.x*this.scale,y:t.y*this.scale,spatialReference:this.spatialReference}),n),ue(n,n,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(n,new Z({spatialReference:this.view.spatialReference}));return i!=null?Et(i.x,i.y,this.defaultZ):null}};function ji(e,t){if(e.type==="2d")return new Wi(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const n=t.length>2?new Z({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new Z({x:t[0],y:t[1],spatialReference:e.spatialReference});return new Ni(e,n)}return null}function L(e,t){const n=new Z({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(n.z=e[2]),n}function qi(e,t){return new In({points:e,spatialReference:t})}function be(e,t,n){const i=new Vn({paths:e,spatialReference:t});return n&&Ue(i),i}function yt(e,t,n,i=!0){const o=Bt(e);o.forEach(a=>{const l=a[0],r=a[a.length-1];Cn(l,r)&&a.length!==1||a.push(a[0])});let s=new Rn({rings:o,spatialReference:t});return s.rings.forEach(a=>{kn(a)||a.reverse()}),n&&Ue(s),i&&s.isSelfIntersecting&&ze(t)&&(s=di(s)),s}function $e(e,t,n){const i=t.mapToLocalMultiple(e),o=[],s={x:i[0].x,y:i[0].y},a={x:i[1].x,y:i[1].y},l=Math.round(a.x-s.x),r=Math.round(a.y-s.y),u=Math.max(Math.abs(l),Math.abs(r));if(n){const d={x:s.x+u,y:s.y+u},m={x:s.x-u,y:s.y-u};o.push(b(d.x,m.y),b(m.x,m.y),b(m.x,d.y),b(d.x,d.y))}else{const d={x:l>0?s.x+u:s.x-u,y:r>0?s.y+u:s.y-u};o.push(b(s.x,s.y),b(d.x,s.y),b(d.x,d.y),b(s.x,d.y))}return sn(yt([o.map(d=>t.localToMap(d)).filter(mt)],t.spatialReference,t.doUnnormalization,!0),o,t)}function Bi(e,t,n){let i=t.mapToLocalMultiple(e);if(i.length===1){const r=i[0];i=[b(r.x-48,r.y+48),b(r.x+48,r.y-48),b(r.x+48,r.y-48),b(r.x-48,r.y+48)]}const o=[],s={x:i[0].x,y:i[0].y},a={x:i[1].x,y:i[1].y};if(n){const l=Math.round(a.x-s.x),r=Math.round(a.y-s.y);o.push(b(s.x-l,s.y-r),b(a.x,s.y-r),b(a.x,a.y),b(s.x-l,a.y))}else o.push(b(s.x,s.y),b(a.x,s.y),b(a.x,a.y),b(s.x,a.y));return sn(yt([o.map(l=>t.localToMap(l)).filter(mt)],t.spatialReference,t.doUnnormalization,!0),o,t)}function sn(e,t,n){const i=wt(t[3],t[2],n),o=wt(t[1],t[2],n),s=wt(t[0],t[1],n),a=wt(t[0],t[3],n);return{geometry:e,midpoints:i!=null&&o!=null&&s!=null&&a!=null?{top:i,right:o,bottom:s,left:a}:null}}function wt(e,t,n){j[0]=e.x,j[1]=e.y,j[2]=0,q[0]=t.x,q[1]=t.y,q[2]=0,An(j,j,q,.5),bt.x=j[0],bt.y=q[1],bt.z=q[2];const i=n.localToMap(bt);return i!=null?L(i,n.spatialReference):null}const bt=b(0,0,0),j=C(),q=C();function Se(e,t,n,i){const o=t.mapToLocalMultiple(e);let s=null,a=null;if(n)s=o[0],a=o[1];else{const _=o[0],y=o[1],$=Math.round(y.x-_.x),f=Math.round(y.y-_.y),x=Math.max(Math.abs($),Math.abs(f));s=b($>0?_.x+x/2:_.x-x/2,f>0?_.y+x/2:_.y-x/2),a=b(Math.abs($)>Math.abs(f)?s.x-x/2:s.x,Math.abs($)>Math.abs(f)?s.y:s.y-x/2)}const l=t.localToMap(s),r=t.localToMap(a);if(l==null||r==null)return null;t.doUnnormalization&&Pn([[l,r]],t.spatialReference);const u=L(l,t.spatialReference),d=L(r,t.spatialReference),m=qt(t.spatialReference);let v=0;if(ze(t.spatialReference))v=m*ui(u,d,null);else{const _=s.x-a.x,y=s.y-a.y;v=m*Math.sqrt(_*_+y*y)*1}const h=new En({center:u,radius:v,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:yt(h.rings,h.spatialReference,!1),center:u,edge:d}}function Yi(e,t,n){const i=t.mapToLocalMultiple(e),o=i[0],s=i[1],a=Math.round(s.x-o.x),l=Math.round(s.y-o.y),r=b(n?o.x:o.x+a/2,n?o.y:o.y+l/2),u=n?a:a/2,d=n?l:l/2,m=60,v=[],h=2*Math.PI/m;function _(P){const nt=Math.cos(P),ft=Math.sin(P);return b(u*nt+r.x,d*ft+r.y)}for(let P=0;P<m;P++)v.push(_(P*h));v.push(v[0]);const{spatialReference:y,doUnnormalization:$}=t,f=yt([v.map(P=>t.localToMap(P)).filter(mt)],y,$,!1),x=t.localToMap(_(Math.PI/2)),T=t.localToMap(_(0)),z=t.localToMap(_(-Math.PI/2)),U=t.localToMap(_(Math.PI));return{geometry:f,midpoints:x!=null&&T!=null&&z!=null&&U!=null?{top:L(x,y),right:L(T,y),bottom:L(z,y),left:L(U,y)}:null}}function tt(e,t,n){if(e==null)return"noTool";switch(e){case"point":return Xi();case"multipoint":return"multipoint";case"polyline":return Ki(t,n);case"polygon":return Qi(t,n);case"rectangle":case"circle":return Ji(t,n);default:return}}function Xi(e){return"point"}function Ki(e,t){const n=e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0;return t==="freehand"?n<2?"freehandStart":"freehandEnd":n<2?"polylineZeroVertices":"polylineOneVertex"}function Qi(e,t){const n=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(n<4)return t==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Ji(e,t){if((e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function to(e,t){const n=e==null?void 0:e.geometry;if(!e||(n==null?void 0:n.type)!=="mesh"||!t)return;const{renderCoordsHelper:i,elevationProvider:o}=t,{camera:s}=t.state,{extent:a}=n,{center:l,spatialReference:r}=a,u=qt(r),d=ee(r),m=qt(i.spatialReference),v=a.width*u,h=a.height*d,_=(a.zmax??0)*d,y=_-(a.zmin??0)*d,$=Math.max(v,h,y)/m,{x:f,y:x}=l,T=l.z??0;Fe($t,f,x,T),i.toRenderCoords($t,r,$t);const z=$/s.computeScreenPixelSizeAt($t);if(z>s.width*no)return"meshTooClose";if(z<eo)return"meshTooFar";const U=gi(e),{absoluteZ:P}=yi(f,x,_,r,t,U);return P<(o.getElevation(f,x,T,r,"ground")??0)*d+y*io?"meshUnderground":"mesh"}const eo=20,no=1,io=.1,$t=C();function oo(e,t,n,i,o,s){let a="geodesic",l=Un(n);const r=J();return ie(e,t,i,r),r[2]=0,l&&Vt(r,n,r,l)||(a="euclidean",l=n),{mode:a,view:t,elevationInfo:i,hasZ:o,directionMode:s,spatialReference:e.spatialReference,measurementSR:l,origin:r}}function so(e,t,n){if(t==null||e==null)return;const i=Fn(n.measurementSR);if(i==null)return;const o=zt(e,n);if(o==null)return;const s=Ct(t,i);return new Ci(o,s)}function ro(e,t,n,i){if(n==null||e==null)return;const o=zt(e,i);if(o==null)return;const s=Q(n),a=10,l=u=>{if(u==null)return;const d=J(),m=Gn(u,"degrees","geographic");return Vi(d,o,i.measurementSR,a,m,i.mode)?new ki(o,d):void 0},r=()=>{if(t!=null&&e!=null)return Q(tn(t,e))};switch(i.directionMode){case K.Absolute:return l(s);case K.Relative:{const u=r();return u==null?void 0:l(u+s)}case K.RelativeBilateral:{const u=r();return u==null?void 0:Je([l(u+s),l(u-s)])}}}function rn(e,t){const n=Ut(e,t);return n!=null?new Ri(n):void 0}function an(e,t,n){const{context:i,longitude:o,latitude:s,direction:a,distance:l,elevation:r}=n;if(o!=null||s!=null||l!=null||r!=null||a!=null){if(o!=null||s!=null){const u=Q(o),d=Q(s),m=Ut(r,i);return new Qe(u,d,m)}return ao(e,t,n)}}function ao(e,t,{context:n,direction:i,distance:o,elevation:s}){if(t==null)return rn(s,n);const{view:a,elevationInfo:l,measurementSR:r}=n,u=ie(t,a,l);if(!r||!Vt(u,t.spatialReference,Te,r))return;const[d,m]=Te,v=o!=null?Ct(o,"meters"):void 0,h=Q(i),_=Ut(s,n),y=f=>{const x=new Ii([d,m],r,v,_,f);return v==null||f==null||_==null&&n.hasZ?x:new Ai(x.closestTo(u))};if(h==null)return y(void 0);const $=()=>{if(e!=null&&t!=null)return Q(tn(e,t))};switch(n.directionMode){case K.Absolute:return y(h);case K.Relative:{const f=$();return f==null?void 0:y(f+h)}case K.RelativeBilateral:{const f=$();return f==null?void 0:Je([y(f+h),y(f-h)])}}}function lo(e){return e.context.mode==="geodesic"?an(null,null,e):ln(e)}function co(e,t,n){const{context:i,x:o,y:s,distance:a,direction:l,elevation:r}=n;return i.mode==="geodesic"?an(t,e,n):o!=null||s!=null?ln(n):po([so(e,a,i),ro(e,t,l,i),rn(r,i)])}function ln({x:e,y:t,elevation:n,context:i}){St.x=(e==null?void 0:e.value)??0,St.y=(t==null?void 0:t.value)??0,St.spatialReference=i.spatialReference;const o=zt(St,i,mo);return new Qe(e!=null&&o!=null?o[0]:void 0,t!=null&&o!=null?o[1]:void 0,Ut(n,i))}function po(e){let t;for(const n of e)n&&(t=(t==null?void 0:t.intersect(n))??n);return t}function zt(e,t,n=J()){const{view:i,elevationInfo:o,measurementSR:s,origin:a,mode:l}=t;if(ie(e,i,o,n),Vt(n,e.spatialReference,n,s))return l!=="geodesic"&&Ae(n,n,a),n}function uo(e,t,n,i){const{view:o,measurementSR:s,spatialReference:a,origin:l,mode:r}=n;if(r==="geodesic"?zn(rt,e):Mt(rt,e,l),Vt(rt,s,rt,a))return Ei(rt,o,t,n,i)}function Ut(e,t){var n;return((n=ho(e,t))==null?void 0:n.value)??void 0}function ho(e,{view:t,origin:n,elevationInfo:i,hasZ:o,measurementSR:s}){if(e==null||!o)return;const a=Hn(s);if(a==null)return;const[l,r]=n,u=Ct(e,a),d=(t==null?void 0:t.type)==="3d"?je(t,l,r,u,s,i):u;return d!=null?He(d,a):void 0}const Te=J(),mo=J(),rt=J(),St=oe(0,0,0,Ge.WGS84);let k=class extends N{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=ut}get allFields(){return[]}};c([p()],k.prototype,"type",void 0),c([p()],k.prototype,"radius",void 0),c([p()],k.prototype,"xSize",void 0),c([p()],k.prototype,"ySize",void 0),c([p()],k.prototype,"area",void 0),c([p()],k.prototype,"helpMessage",void 0),c([p()],k.prototype,"allFields",null),k=c([O("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],k);let at=class extends gt(N){constructor(t){super(t),this.type="draw-mesh",this.orientation=vi({lockable:!1}),this.scale=_i({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};c([p()],at.prototype,"helpMessage",void 0),c([p()],at.prototype,"allFields",null),at=c([O("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],at);let lt=class extends gt(N){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};c([p()],lt.prototype,"helpMessage",void 0),c([p()],lt.prototype,"allFields",null),lt=c([O("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],lt);let ct=class extends gt(N){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};c([p()],ct.prototype,"helpMessage",void 0),c([p()],ct.prototype,"allFields",null),ct=c([O("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],ct);let B=class extends gt(N){constructor(t){super(t),this.type="draw-polygon",this.direction=Ye(),this.distance=Xe(),this.area=xi(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};c([p()],B.prototype,"xyMode",void 0),c([p()],B.prototype,"helpMessage",void 0),c([p()],B.prototype,"allFields",null),B=c([O("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],B);let Y=class extends gt(N){constructor(t){super(t),this.type="draw-polyline",this.direction=Ye(),this.distance=Xe(),this.totalLength=wi(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};c([p()],Y.prototype,"helpMessage",void 0),c([p()],Y.prototype,"xyMode",void 0),c([p()],Y.prototype,"allFields",null),Y=c([O("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Y);let I=class extends N{constructor(t){super(t),this.type="draw-rectangle",this.xSize=W,this.ySize=W,this.area=ut}get allFields(){return[]}};c([p()],I.prototype,"type",void 0),c([p()],I.prototype,"xSize",void 0),c([p()],I.prototype,"ySize",void 0),c([p()],I.prototype,"area",void 0),c([p()],I.prototype,"helpMessage",void 0),c([p()],I.prototype,"allFields",null),I=c([O("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],I);function go(e,t){return{point:new ct({sketchOptions:t,viewType:e}),multipoint:new lt({sketchOptions:t,viewType:e}),polyline:new Y({sketchOptions:t,viewType:e}),polygon:new B({sketchOptions:t,viewType:e}),mesh:new at({sketchOptions:t,viewType:e}),rectangle:new I({sketchOptions:t}),circle:new k({sketchOptions:t})}}function Me(e){const{directionOptions:t,geometryType:n,sketchOptions:i,tooltipInfos:o}=e,s=l=>{const r=Ft(e).mode,u=o[l].elevation;r==="relative-to-ground"||r==="relative-to-scene"||r==="on-the-ground"?u.lock(ae(e)):u.unlock()},a=l=>{if(t){const r=o[l].direction;r.committed=t.angle,r.unlockOnVertexPlacement=!1,i.values.directionMode=t.mode}};switch(n){case"polygon":case"polyline":s(n),a(n);break;case"point":case"mesh":s(n)}}function yo(e,t){const{drawOperation:n,view:i}=t,o=se(t),s=Ft(t);if(i.type==="2d"||!e||s.mode!=="absolute-height"||(n==null?void 0:n.numCommittedVertices)!==1||!o||o.type!=="draw-polyline"&&o.type!=="draw-polygon"||o.elevation.locked)return;const[a,l,r]=e,u=Eo(a,l,r,s,t);u!=null&&o.elevation.lock(u)}function Oe(e){var t;(t=se(e))==null||t.allFields.forEach(n=>{n.unlockOnVertexPlacement&&n.unlock()})}function se({geometryType:e,graphic:t,tooltipInfos:n}){var i;return((i=t==null?void 0:t.geometry)==null?void 0:i.type)!==fo[e]?e==="circle"||e==="rectangle"?n[e]:null:n[e]}const fo={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function vo(e,t){switch(e==null?void 0:e.type){case"draw-point":_o(e,t);break;case"draw-multipoint":xo(e,t);break;case"draw-polyline":bo(e,t);break;case"draw-polygon":$o(e,t);break;case"draw-rectangle":To(e,t);break;case"draw-circle":Mo(e,t);break;case"draw-mesh":wo(e,t)}}function _o(e,t){var i;const n=(i=t.graphic)==null?void 0:i.geometry;(n==null?void 0:n.type)==="point"&&(re(e,n,t),e.helpMessage=tt("point",n,t.drawOperation.drawingMode))}function xo(e,t){var i;const n=(i=t.graphic)==null?void 0:i.geometry;(n==null?void 0:n.type)==="multipoint"&&(re(e,n,t),e.helpMessage=tt("multipoint",n,t.drawOperation.drawingMode))}function wo(e,t){const{graphic:n,view:i}=t,o=n==null?void 0:n.geometry;i.type!=="3d"||o&&o.type!=="mesh"||(re(e,o==null?void 0:o.origin,t),o&&ii(e,o),e.helpMessage=to(n,i))}function re(e,t,n){const{drawOperation:i,view:o,sketchOptions:s}=n,{cursorVertex:a}=i;e.sketchOptions=s,e.viewType=o.type;const l=(t==null?void 0:t.type)==="multipoint"?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(l,et(n)),pn(e.elevation,n),!a)return void(i.constraints=void 0);const r=a;i.constraints={context:mn(r,n),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function bo(e,t){const{createOperationGeometry:n,drawOperation:i}=t,o=n!=null?n.full:null;o&&o.type!=="polyline"||(cn(e,t),e.totalLength.actual=i.lastVertex?(o?oi(o):null)??W:null,e.helpMessage=tt("polyline",o,t.drawOperation.drawingMode))}function $o(e,t){const{createOperationGeometry:n,drawOperation:i}=t,o=n!=null?n.full:null;o&&o.type!=="polygon"||(cn(e,t),e.area.actual=i.lastVertex?(o?Ke(o):null)??ut:null,e.helpMessage=tt("polygon",o,t.drawOperation.drawingMode))}function cn(e,t){const{drawOperation:n,sketchOptions:i,view:o}=t,{cursorVertex:s,lastVertex:a,secondToLastVertex:l}=n,r=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=o.type;const u=a&&s?Rt(a,s)??W:null;if(e.distance.actual=u,e.distance.readOnly=a==null,e.direction.actual=null,e.direction.readOnly=!0,a&&s&&(r==="absolute"||l)){const v=zi(l,a,s,r);e.direction.actual=v??Dn,e.direction.readOnly=!1}e.setLocationFromPoint(s,et(t)),pn(e.elevation,t);const d=So(a,t);e.xyMode=d,e.direction.visible=d==="direction-distance",e.distance.visible=d==="direction-distance",e.effectiveX.visible=d==="coordinates",e.effectiveY.visible=d==="coordinates";const m=s??a;n.constraints=m?{context:mn(m,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function So(e,{sketchOptions:t}){const n=t.tooltips.xyMode;return n==="auto"?e?"direction-distance":"coordinates":n}function To(e,t){var n;e.sketchOptions=t.sketchOptions,e.xSize=dn(t),e.ySize=hn(t),e.area=un(t),e.helpMessage=tt("rectangle",(n=t.graphic)==null?void 0:n.geometry,t.drawOperation.drawingMode)}function Mo(e,t){var o;const{forceUniformSize:n,sketchOptions:i}=t;e.sketchOptions=i,e.radius=n?Oo(t):null,e.xSize=n?null:dn(t),e.ySize=n?null:hn(t),e.area=un(t),e.helpMessage=tt("circle",(o=t.graphic)==null?void 0:o.geometry,t.drawOperation.drawingMode)}function pn(e,t){const{drawOperation:n}=t,i=(n==null?void 0:n.cursorVertex)??(n==null?void 0:n.lastVertex);e.actual=ri(i)??ae(t),e.visible=n.hasZ,e.readOnly=!1,e.showAsZ=!0}function un(e){var n;const t=(n=e.createOperationGeometry)==null?void 0:n.full;return(t==null?void 0:t.type)!=="polygon"?ut:Ke(t)??ut}function dn(e){var n,i;const t=(i=(n=e.createOperationGeometry)==null?void 0:n.rectangle)==null?void 0:i.midpoints;return(t!=null?Rt(t.left,t.right):null)??W}function hn(e){var n,i;const t=(i=(n=e.createOperationGeometry)==null?void 0:n.rectangle)==null?void 0:i.midpoints;return(t!=null?Rt(t.top,t.bottom):null)??W}function Oo({createOperationGeometry:e}){var t;return(((t=e==null?void 0:e.circle)==null?void 0:t.center)!=null&&e.circle.edge!=null?Rt(e.circle.center,e.circle.edge):null)??W}function Po(e){const{geometryType:t,tooltipInfos:n}=e;switch(t){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const i=n[t].elevation.committed;return i?Ct(i,"meters")/ee(et(e)):void 0}default:return}}function Eo(e,t,n,i,o){const{view:s,drawOperation:a}=o;if(s.type!=="3d"||!a)return;n??(n=0);const l=et(o),r=Ft(o),u=je(s,e,t,n,l,r,i);return si(u,l)??ae(o)}function Ft(e){return e.drawOperation.elevationInfo??qe}function et(e){return e.drawOperation.coordinateHelper.spatialReference}function ae(e){const t=ee(et(e));return He(e.defaultZ*t,"meters")}function mn(e,t){return oo(e,t.view,et(t),Ft(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var D;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(D||(D={}));let Co=class{constructor(){this._isToolEditable=!0,this._manipulators=new Nt,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,n=D.WhenToolEditable){this.addMany([t],n)}addMany(t,n=D.WhenToolEditable){for(const i of t){const o={manipulator:i,visibilityPredicate:n,attached:!1};this._manipulators.add(o),this._attached&&this._updateManipulatorAttachment(o)}}remove(t){for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.at(n).manipulator===t){const i=this._manipulators.splice(n,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,n){return this._manipulators.on(t,i=>{n(i)})}forEach(t){for(const n of this._manipulators.items)t(n)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(n=>t.push(n.manipulator)),t}intersect(t,n){let i=null,o=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:s,attached:a})=>{if(!a||!s.interactive)return;const l=s.intersectionDistance(t,n);l!=null&&l<o&&(o=l,i=s)}),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const n=t.manipulator;n.grabbing=!1,n.dragging=!1,n.hovering=!1,n.selected=!1,n.detach&&n.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===D.Always||(this._isToolEditable?t.visibilityPredicate===D.WhenToolEditable:t.visibilityPredicate===D.WhenToolNotEditable)}},S=class extends ht{constructor(e){super(e),this.manipulators=new Co,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[F.MANAGER,!0],[F.USER,!0]]),this._creationFinishedResolver=Zn()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(F.USER)}set editable(e){this.setEditableFlag(F.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===F.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:n})=>{n.dragging&&(t=!0,n.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(F.USER)&&this.getEditableFlag(F.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};c([p({constructOnly:!0})],S.prototype,"view",void 0),c([p({readOnly:!0})],S.prototype,"active",null),c([p({value:!0})],S.prototype,"visible",null),c([p({value:!0})],S.prototype,"editable",null),c([p({readOnly:!0})],S.prototype,"manipulators",void 0),c([p({readOnly:!0})],S.prototype,"updating",null),c([p()],S.prototype,"cursor",null),c([p({readOnly:!0})],S.prototype,"automaticManipulatorSelection",void 0),c([p()],S.prototype,"hasFocusedManipulators",null),c([p()],S.prototype,"hasGrabbedManipulators",void 0),c([p()],S.prototype,"hasHoveredManipulators",void 0),c([p()],S.prototype,"firstGrabbedManipulator",void 0),c([p({readOnly:!0})],S.prototype,"created",void 0),c([p({readOnly:!0})],S.prototype,"removeIncompleteOnCancel",void 0),S=c([O("esri.views.interactive.InteractiveToolBase")],S);let w=class extends ne.EventedMixin(S){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new en}initialize(){const{view:e}=this;this.internalGraphicsLayer=new Ln({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=go(e.type,this.sketchOptions);const n=ai(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=n,Me(this._tooltipsContext),this._coordinateFormatterLoadTask=Wn(()=>li()),this.addHandles([t.on("vertex-add",i=>this.onVertexAdd(i)),t.on("vertex-remove",i=>this.onVertexRemove(i)),t.on("vertex-update",i=>this.onVertexUpdate(i)),t.on("cursor-update",i=>this.onCursorUpdate(i)),t.on("cursor-remove",()=>this._updateGraphic()),t.on("complete",i=>this.onComplete(i)),this._coordinateFormatterLoadTask,n.on("paste",i=>ci(i,this.activeTooltipInfo)),H(()=>this.cursor,i=>{t.cursor=i},Tt),de(()=>{const{activeTooltipInfo:i,sketchOptions:o}=this;vo(i,this._tooltipsContext),n.info=o.tooltips.effectiveEnabled?i:null}),de(()=>{t.constraintZ=Po(this._tooltipsContext)},jn)]),this.finishToolCreation()}destroy(){this.drawOperation=X(this.drawOperation),this.tooltip=X(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=X(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){var e;return((e=this.drawOperation)==null?void 0:e.updating)??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return e==="2d"&&t&&"undoRedo"in t&&t.undoRedo instanceof R?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||pi(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&Me(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(E.outline),this.removeHandles(E.regularVertices),this.removeHandles(E.activeVertex),this.removeHandles(E.activeEdge),this.removeHandles(Zt)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;const t=new Nn({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(_t(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),Zt),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){var y,$;if(this.drawOperation==null)return;const{coordinateHelper:t,view:n,visualizationCursorVertex:i,lastVertex:o,committedVertices:s,geometryIncludingUncommittedVertices:a,numCommittedVertices:l}=this.drawOperation;if(!(l>0||i!=null))return;const r=e.operationComplete?s:a,u=r.length,d=i!=null?t.pointToArray(i):null,m=this._drawSpatialReference,v=n.type==="3d"&&n.viewingMode==="global",h=new Li;h.committedVertices=s,h.cursorVertex=d;const{geometryType:_}=this;switch(_){case"point":case"mesh":h.full=t.arrayToPoint(r[0]);break;case"multipoint":h.full=u>0?qi(r,m):null;break;case"polyline":case"polygon":u>0&&(h.full=_==="polygon"?yt([r],m,v,!0):be([r],m,v),h.cursorEdge=d!=null&&o&&!pt(i,o)?be([[d,t.pointToArray(o)]],m,v):null,h.outline=u>1?h.full:null);break;case"circle":case"rectangle":{if(h.committedVertices=h.cursorVertex=null,!u)break;const f=ji(n,r[0]),x=r[0],T=f.makeMapPoint(x[0]+Ro*n.resolution,x[1]);_==="circle"?u===1&&e.operationComplete?h.circle=Se([x,T],f,!0):u===2&&(this.forceUniformSize?h.circle=Se(r,f,this.centered):h.rectangle=Yi(r,f,this.centered)):u===1&&e.operationComplete?h.rectangle=$e([x,T],f,!0):u===2&&(h.rectangle=this.forceUniformSize?$e(r,f,this.centered):Bi(r,f,this.centered)),h.full=h.circle!=null?h.circle.geometry:(y=h.rectangle)==null?void 0:y.geometry,h.outline=(($=h.full)==null?void 0:$.type)==="polygon"?h.full:null;break}default:return null}return h}initializeGraphic(e){return _t()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const n=this._getCreateOperationGeometry({operationComplete:!0});n!=null&&(t=this._createOrUpdateGraphic(n.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return _t()}onCursorEdgeChanged(e){return _t()}onVertexAdd(e){var t;Oe(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||yo((t=e.vertices.at(0))==null?void 0:t.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){Oe(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),E.activeEdge):this.removeHandles(E.activeEdge),e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),E.outline):this.removeHandles(E.outline),e.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),E.regularVertices):this.removeHandles(E.regularVertices),e.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),E.activeVertex):this.removeHandles(E.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(Zt)):this._destroyAllVisualizations()}get activeTooltipInfo(){var e;return(e=this._coordinateFormatterLoadTask)!=null&&e.finished?se(this._tooltipsContext):null}};c([p()],w.prototype,"_coordinateFormatterLoadTask",void 0),c([p()],w.prototype,"_createOperationGeometry",void 0),c([p()],w.prototype,"_tooltipsContext",null),c([p({value:!0})],w.prototype,"centered",null),c([p()],w.prototype,"cursor",null),c([p({nonNullable:!0})],w.prototype,"defaultZ",void 0),c([p({constructOnly:!0})],w.prototype,"directionOptions",void 0),c([p()],w.prototype,"drawOperation",void 0),c([p()],w.prototype,"elevationLockOnVertexAddDisabled",void 0),c([p({value:!0})],w.prototype,"enabled",null),c([p({value:!0})],w.prototype,"forceUniformSize",null),c([p({constructOnly:!0})],w.prototype,"geometryType",void 0),c([p()],w.prototype,"graphic",null),c([p({constructOnly:!0})],w.prototype,"graphicProperties",void 0),c([p()],w.prototype,"graphicSymbol",null),c([p({constructOnly:!0})],w.prototype,"hasZ",void 0),c([p({constructOnly:!0})],w.prototype,"geometryToPlace",void 0),c([p()],w.prototype,"mode",null),c([p()],w.prototype,"snappingManager",void 0),c([p()],w.prototype,"snapToScene",void 0),c([p()],w.prototype,"tooltip",void 0),c([p()],w.prototype,"tooltipInfos",void 0),c([p({constructOnly:!0,type:en})],w.prototype,"sketchOptions",void 0),c([p()],w.prototype,"updating",null),c([p({constructOnly:!0,nonNullable:!0})],w.prototype,"view",void 0),c([p({constructOnly:!0})],w.prototype,"undoRedo",null),c([p()],w.prototype,"activeTooltipInfo",null),w=c([O("esri.views.draw.DrawGraphicTool")],w);const Zt=Symbol("create-operation-graphic"),E={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Ps(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const Ro=48,gn="click";class ko{constructor({consumesClicks:t,grabbableForEvent:n}){this.events=new ne,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=t,this.grabbableForEvent=n}destroy(){}intersectionDistance(t,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}function Vo(e,t){let n=null,i=null;return o=>{if(o.action==="cancel")return void(i!=null&&(i.execute({action:"cancel"}),n=null,i=null));const s={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};o.action==="start"&&n==null&&(n=new dt,i=new dt,t(e,n,i,o.pointerType,s)),n!=null&&n.execute(s),o.action==="end"&&n!=null&&(n=null,i=null)}}function Lt(e,t){return e.events.on("drag",Vo(e,t))}function Es(e,t){const n=[e.x,e.y,e.z??0],i=t,o=[Math.cos(i),Math.sin(i)],s=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(s===0)return null;o[0]/=s,o[1]/=s;const a=l=>{const r=(l.x-n[0])*o[0]+(l.y-n[1])*o[1];l.x=n[0]+r*o[0],l.y=n[1]+r*o[1]};return l=>(a(l.mapStart),a(l.mapEnd),{...l,axis:o})}function Io(e){let t=null;return n=>{if(n.action==="start"&&(t=Ao(e,n.mapStart.spatialReference)),t==null)return null;const i=n.mapEnd.x-n.mapStart.x,o=n.mapEnd.y-n.mapStart.y,s=(n.mapEnd.z??0)-(n.mapStart.z??0);return t.move(i,o,s,n.action),{...n,translationX:i,translationY:o,translationZ:s}}}function Pe(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():Ot(e,t)}function Ao(e,t){const n=e.operations;if(!n)return null;const i=n.data.geometry,o=Hi(t);if(i.spatialReference.equals(o))return Wt(e,n,()=>{});if(i.type!=="mesh"){const s=Pe(i,o);if(s==null)return null;const a=i.spatialReference;return Wt(e,Kt.fromGeometry(s,n.viewingMode),()=>{const l=Ot(i,a);n.trySetGeometry(l)})}if(Gi(i)){const s=Pe(i.origin,o);if(!s)return null;const a=i.spatialReference,l=Kt.fromGeometry(s,n.viewingMode);return Wt(e,n,()=>{const r=Ot(l.data.geometry,a),u=r.x-i.origin.x,d=r.y-i.origin.y,m=(r.z??0)-(i.origin.z??0);n.move(u,d,m)})}return null}function Wt(e,t,n){let i=0,o=0,s=0;return{move:(a,l,r,u)=>{var h;u==="start"&&(i=0,o=0,s=0);const d=a-i,m=l-o,v=r-s;t.move(d,m,v),i+=d,o+=m,s+=v,n(),u==="end"&&((h=e.endInteraction)==null||h.call(e))}}}function Cs(e,t=null,n){var a;let i=null;const o=t==null||(a=e.spatialReference)!=null&&a.equals(t)?l=>l:l=>l!=null?Ot(l,t):l,s={exclude:[],...n};return l=>{if(l.action==="start"&&(i=o(e.toMap(l.screenStart,s))),i==null)return null;const r=o(e.toMap(l.screenEnd,s));return r!=null?{...l,mapStart:i,mapEnd:r}:null}}function Rs(e){const t=e.map(n=>Io(n)).filter(mt);return n=>{const i=n.mapEnd.x-n.mapStart.x,o=n.mapEnd.y-n.mapStart.y,s=n.mapEnd.z-n.mapStart.z;return t.forEach(a=>a(n)),{...n,translationX:i,translationY:o,translationZ:s}}}function zo(e){var n;const t=(n=e.operations)==null?void 0:n.createResetState();return i=>(t==null||t.remove(),i)}function ks(e){const t=e.map(n=>zo(n)).filter(n=>n!=null);return n=>(t.forEach(i=>i(n)),n)}function Vs(){let e=0,t=0,n=0;return i=>{i.action==="start"&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z);const o=i.mapEnd.x-e,s=i.mapEnd.y-t,a=i.mapEnd.z-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:o,mapDeltaY:s,mapDeltaZ:a,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function Is(){let e=0,t=0;return n=>{n.action==="start"&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,o=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:o}}}function As(e,t){let n=null,i=0,o=0;return s=>{var u;if(s.action==="start"&&(n=(u=e.toScreen)==null?void 0:u.call(e,t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=s.screenStart.x-n.x,o=s.screenStart.y-n.y))),n==null)return null;const a=he(s.screenEnd.x-i,0,e.width),l=he(s.screenEnd.y-o,0,e.height),r=De(a,l);return s.screenStart=n,s.screenEnd=r,s}}const Uo=()=>{};class dt{constructor(){this.execute=Uo}next(t,n=new dt){return t!=null&&(this.execute=i=>{const o=t(i);o!=null&&n.execute(o)}),n}}function Fo(e,t,n=[]){if(e.type==="2d")return o=>o;let i=null;return o=>{o.action==="start"&&(i=e.toMap(o.screenStart,{exclude:n}),i!=null&&(i.z=Pt(i,e,t)));const s=e.toMap(o.screenEnd,{exclude:n});s!=null&&(s.z=Pt(s,e,t));const a=i!=null&&s!=null?{sceneStart:i,sceneEnd:s}:null;return{...o,scenePoints:a}}}function Ee(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,o=kt(e);return o.z=i,o.hasZ=!0,o.z=Pt(o,t,n),o}function zs(e,t){if(e.type==="2d")return i=>i;let n=null;return i=>{i.action==="start"&&(n=Ee(i.mapStart,e,t));const o=Ee(i.mapEnd,e,t),s=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...i,scenePoints:s}}}function Go({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:i,useZ:o=!0}){const s=new dt;if(t==null)return{snappingStep:[Ce,s],cancelSnapping:Ce};let a,l=null,r=null,u=null;const d=()=>{l=Yt(l),t.doneSnapping(),r==null||r.frameTask.remove(),r=null,a=Ze(a),u=null},m=Ho(t,o,s);let v=null,h=null,_=null;return{snappingStep:[y=>{if(!e(y))return y;const{action:$}=y;if($==="start"){const{info:f}=y,x=Do(t.view);if(r=Zo(n,y,x),r.context.selfSnappingZ=null,!o&&f!=null){const T=Wo(n.coordinateHelper,f.handle.component);T!=null&&(r.context.selfSnappingZ={value:T,elevationInfo:n.elevationInfo??qe})}}if(r!=null){const{context:f,originalScenePos:x,originalPos:T}=r,{mapEnd:z,mapStart:U,scenePoints:P}=y,nt=yn(T,te(z,U)),ft=te(U,T),_n={...y,action:"update"},xn=r.context,Gt=Lo(x,P),le=t.update({point:nt,scenePoint:Gt,context:f});if(_=le,fn(z,le,ft,o),v=nt,h=Gt,$!=="end"){const{frameTask:wn}=r;l==null&&(l=new AbortController),u=bn=>{i.addPromise(Xt(m({frameTask:wn,event:_n,context:xn,point:nt,scenePoint:Gt,delta:ft,getLastState:()=>({point:v,scenePoint:h,updatePoint:bn.forceUpdate?null:_})},l.signal)))},u({forceUpdate:!1}),a==null&&(a=H(()=>t.options.effectiveEnabled,()=>u==null?void 0:u({forceUpdate:!0})))}}return $==="end"&&d(),y},s],cancelSnapping:y=>(d(),y)}}function Ho(e,t,n){return Ne(async({frameTask:i,point:o,scenePoint:s,context:a,event:l,delta:r,getLastState:u},d)=>{const m=await i.schedule(()=>e.snap({point:o,scenePoint:s,context:a,signal:d}),d);if(m.valid){let v=await i.schedule(()=>m.apply(),d);const h=u();h.point!=null&&o!==h.point&&(v=e.update({point:h.point,scenePoint:h.scenePoint,context:a})),h.updatePoint!=null&&pt(v,h.updatePoint)||(fn(l.mapEnd,v,r,t),n.execute(l))}})}function Do(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(We.SNAPPING):Le}function Zo(e,t,n){return{context:new Qt({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:n}}function yn(e,[t,n,i]){const o=kt(e);return o.x+=t,o.y+=n,o.hasZ&&(o.z+=i),o}function Lo(e,t){return e==null||t==null?null:yn(e,te(t.sceneEnd,t.sceneStart))}function te(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function fn(e,t,[n,i,o],s){e.x=t.x+n,e.y=t.y+i,s&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function Wo(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const o of n){const s=e.getZ(o.pos);if(i!=null&&s!=null&&Math.abs(s-i)>1e-6)return null;i==null&&(i=s)}return i}function Ce(e){return e}let G=class extends ht{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Ne(async(t,n,i,o)=>{const s=this._frameTask;if(s==null)return;const a=await s.schedule(()=>n.snap({...t,context:i,signal:o}),o);a.valid&&await s.schedule(()=>{this.stagedPoint=a.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=n.update({...this._snapPoints,context:i}))},o)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var t,n;const e=this.view.type==="3d"?(n=(t=this.view)==null?void 0:t.resourceController)==null?void 0:n.scheduler:null;this._frameTask=e!=null?e.registerTask(We.SNAPPING):Le}destroy(){this._abortController=Yt(this._abortController),this._frameTask=Ze(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:o}=e,s=t.update({point:i,scenePoint:o,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:o}=e;return this.stagedPoint=t.update({point:i,scenePoint:o,context:n}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=Yt(this._abortController),this._snapPoints=null}};c([p({constructOnly:!0})],G.prototype,"view",void 0),c([p()],G.prototype,"stagedPoint",null),c([p()],G.prototype,"constrainResult",void 0),c([p()],G.prototype,"_stagedPoint",void 0),G=c([O("esri.views.interactive.snapping.SnappingOperation")],G);const No="crosshair",jo="progress",Re=Symbol(),ke=Symbol();let g=class extends ne.EventedMixin(ht){constructor(t){super(t),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new qn,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Ie,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=xe(lo),this._getPolylineOrPolygonConstraint=xe(co),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new nn,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,t.elevationInfo==null&&(this.elevationInfo=fi(!!t.hasZ))}initialize(){const{geometryType:t,view:n}=this,i=n.spatialReference,o="viewingMode"in n.state?n.state.viewingMode:Bn.Local,s=t==="segment"||t==="multipoint"?"polyline":t;this.coordinateHelper=bi(this.hasZ,this.hasM,i),this._editGeometryOperations=new Kt(new $i(s,this.coordinateHelper),o),this._snappingOperation=new G({view:n}),this.addHandles([H(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:r,constraint:u},d)=>{const{snappingOptions:m}=this;if(m&&(m.forceDisabled=u!=null&&Ui(u)),d!=null&&r===d.stagedPoint&&u!==d.constraint)return this._onKeyboardBasedChange();this._processCursor(r??this._screenToMap(this._stagedScreenPoint))},{equals:(r,u)=>r.stagedPoint===u.stagedPoint&&Yn(r.constraint,u.constraint)}),H(()=>this.view.viewpoint,(r,u)=>{r&&u&&Xn(r,u)&&this._onKeyboardBasedChange()})]),this._activeComponent=new Si(i,o),this._editGeometryOperations.data.components.push(this._activeComponent);const a=this.segmentLabels;a!=null&&(a.context={view:n,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles(H(()=>this.labelOptions.enabled,r=>{a.visible=r},Tt))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],r=>{var _,y,$,f;const u=r.vertices.map(x=>({componentIndex:0,vertexIndex:x.index,coordinates:this.coordinateHelper.vectorToArray(x.pos)})),d=u.map(x=>x.coordinates),m=this.coordinateHelper.vectorToDehydratedPoint((_=this._activeComponent.getFirstVertex())==null?void 0:_.pos)??null;pt(m,this.firstVertex)||(this.firstVertex=m);const v=this.coordinateHelper.vectorToDehydratedPoint((y=this._activeComponent.getLastVertex())==null?void 0:y.pos)??null;pt(v,this.lastVertex)||(this.lastVertex=v);const h=this.coordinateHelper.vectorToDehydratedPoint((f=($=this._activeComponent.edges.at(-1))==null?void 0:$.leftVertex)==null?void 0:f.pos)??null;switch(pt(h,this.secondToLastVertex)||(this.secondToLastVertex=h),this._processCursor(this.cursorVertex),r.type){case"vertex-add":this.emit(r.type,{...r,added:d,vertices:u});break;case"vertex-update":this.emit(r.type,{...r,updated:d,vertices:u});break;case"vertex-remove":this.emit(r.type,{...r,removed:d,vertices:u})}}));const l=this._manipulator=new ko({consumesClicks:!1,grabbableForEvent:r=>this.drawingMode!=="click"||r.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(l),l.grabbable=t!=="point"&&t!=="multipoint",this.addHandles([l.events.on("immediate-click",r=>this._onImmediateClick(r)),l.events.on("immediate-double-click",r=>this._onImmediateDoubleClick(r)),H(()=>this.drawingMode,()=>{this.removeHandles(Re),this.addHandles(this._createManipulatorDragPipeline(l),Re)},Tt),H(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:r})=>{l.cursor=r},Tt)]),Fi(this,()=>{const r=this.view.inputManager.latestPointerType??"mouse",u=this._getSnappingContext(r);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,u);this._updatingHandles.addPromise(Xt(d))}})}destroy(){X(this.segmentLabels),X(this._snappingOperation),this._editGeometryOperations=X(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:t,_manipulator:n}=this;return t!=null&&this._pointerDownStates.has(t)||n.grabbing||!n.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const t=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==t}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(t=>this.coordinateHelper.vectorToArray(t.pos))}get _constraint(){const{constraints:t,constraintsEnabled:n}=this;if(t&&n)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(t);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,t)}}set drawingMode(t){this._set("drawingMode",t??gn)}get effectiveCursor(){return this.loading?jo:this._hideDefaultCursor?null:this.cursor||No}get interactive(){return this._manipulator.interactive}set interactive(t){this._manipulator.interactive=t}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:t,lastVertex:n,firstVertex:i,geometryType:o}=this;return o==="polygon"&&Dt(t,i)||Dt(t,n)?null:t}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:t,committableVertex:n,coordinateHelper:i}=this,o=t.slice();return n!=null&&o.push(i.pointToArray(n)),o}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:t}=this;t!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(t))}complete(t){var a;const n=(t==null?void 0:t.aborted)||!1;this._snappingOperation.abort(),(a=this.snappingManager)==null||a.doneSnapping();const{geometryType:i,numCommittedVertices:o}=this,s=i==="multipoint"&&o===0||i==="polyline"&&o<2||i==="polygon"&&o<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||n)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((l,r)=>({componentIndex:0,vertexIndex:r,coordinates:l})),aborted:n,type:"complete"}))}onInputEvent(t){switch(t.type){case"pointer-down":this._pointerDownStates.add(t.pointerId);break;case"pointer-up":this._pointerDownStates.delete(t.pointerId)}switch(t.type){case"pointer-move":return this._onPointerMove(t);case"hold":return this._onHold(t)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(t){var l,r;const n=Bt(this.cursorVertex),i=Bt(t),o=i&&(((l=this._updateAndGetEffectiveDrawSurface())==null?void 0:l.constrainZ(i))??i),s=this._snapToClosingVertex(o),a=this._applyConstraints(s);Dt(n,a)||(this._set("cursorVertex",a),(r=this.segmentLabels)==null||r.set("stagedVertex",a!=null?this.coordinateHelper.pointToVector(a):null),a==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(a)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(t){if(t==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return t;const n=this._mapToScreen(t);if(!n)return t;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,n)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,n)?this.lastVertex:t}_createManipulatorDragPipeline(t){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(t);case"freehand":return this._createManipulatorDragPipelineFreehand(t);case"hybrid":return this._createManipulatorDragPipelineHybrid(t)}}_createManipulatorDragPipelineClick(t){return Lt(t,(n,i,o,s)=>{const a=s==="touch"&&this._snappingEnabled;if(this.isCompleted||!a)return;const{snappingStep:l,cancelSnapping:r}=Go({predicate:()=>a,snappingManager:this.snappingManager,snappingContext:new Qt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});o=o.next(u=>(a&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),u)).next(r),i.next(this._screenToMapDragEventStep()).next(u=>(u.action==="start"&&(this._processCursor(u.mapStart),(this.geometryType==="segment"||a&&!this.numCommittedVertices)&&this.commitStagedVertex()),u)).next(Fo(this.view,this.elevationInfo)).next(...l).next(u=>(a&&(this._processCursor(u.mapEnd),u.action==="end"&&this.commitStagedVertex()),u)).next(u=>(u.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),u))})}_createManipulatorDragPipelineFreehand(t){return Lt(t,(n,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(o.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return o})})}_createManipulatorDragPipelineHybrid(t){return Lt(t,(n,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(o=>(o.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),ke),this._processCursor(o.mapStart),this.commitStagedVertex()),o)).next(o=>{switch(o.action){case"start":case"update":this._processCursor(o.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(ke),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return o})})}get _drawAtFixedElevation(){const{constraintsEnabled:t,constraintZ:n,geometryType:i,numCommittedVertices:o}=this;return t?n!=null||i==="segment"&&o>0:(i==="segment"||i==="polygon")&&o>0}_updateAndGetEffectiveDrawSurface(){var u;const{constraintsEnabled:t,coordinateHelper:n,drawSurface:i,elevationDrawSurface:o,snapToSceneEnabled:s}=this;if(o==null)return i;if(!this.hasZ)return o.defaultZ=null,o;const a=(u=this.elevationInfo)==null?void 0:u.mode;let l=this.defaultZ,r=t||a==="absolute-height";return s!=null&&(r=s),a==="on-the-ground"&&(r=!1),this._drawAtFixedElevation&&(l=(t?this.constraintZ:null)??n.getZ(this._activeComponent.vertices[0].pos),r=!1),r?i:(o.defaultZ=l,o)}_mapToScreen(t){var n;return(n=this._updateAndGetEffectiveDrawSurface())==null?void 0:n.mapToScreen(t)}_onHold(t){this._snappingOperation.abort(),this.drawingMode==="click"&&t.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(t.mapPoint),t.stopPropagation()}_onImmediateClick(t){if(!(t.pointerType==="mouse"&&t.button===2||this._manipulator.dragging))try{const{drawingMode:n,geometryType:i}=this;this._stagedPointerType=t.pointerType,this._stagedScreenPoint=t.screenPoint;const o=this._screenToMap(t.screenPoint);if(o==null||o==null||n==="freehand"&&i!=="point"&&i!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(o),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),t.pointerType!=="mouse"&&this._processCursor(null),(n==="freehand"&&this.geometryType!=="multipoint"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&n==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{t.stopPropagation()}}_onImmediateDoubleClick(t){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),t.stopPropagation())}_onPointerMove(t){const n=De(t.x,t.y);this._stagedScreenPoint=n,this._stagedPointerType=t.pointerType,this._stagedPointerId=t.pointerId,this._isDragging?this._snappingOperation.abort():(t.stopPropagation(),this._processCursorMovementRelativeToSurface(n,t.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(t,n){var r;const i=this._snappingOperation,o=this._screenToMap(t),s=this._requiresScenePoint?(r=this.drawSurface)==null?void 0:r.screenToMap(t):null;if(o==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const a=this.snappingManager;if(a==null)return this._processCursor(o),void i.abort();const l=this._getSnappingContext(n);this._updatingHandles.addPromise(Xt(i.snap({point:o,scenePoint:s},a,l)))}_applyConstraints(t){const{_constraint:n,constraints:i}=this;if(!t||!i||!n)return t;const{context:o}=i,s=zt(t,o),a=s?n.closestTo(s):void 0;if(!a)return t;const l=uo(a,t,o),r=this.view.type==="2d"||o.elevationInfo.mode!=="absolute-height";return l!=null&&r&&this.constraintZ!=null&&this.hasZ&&(l.z=this.constraintZ),l}_screenToMap(t){var n;return t?(n=this._updateAndGetEffectiveDrawSurface())==null?void 0:n.screenToMap(t):null}_screenToMapDragEventStep(){let t=null;return n=>{if(n.action==="start"&&(t=this._screenToMap(n.screenStart)),t==null)return null;const i=this._screenToMap(n.screenEnd);return i!=null?{...n,mapStart:t,mapEnd:i}:null}}_vertexWithinPointerDistance(t,n){const o=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(t));return o!=null&&qo(o,n,25)}_getSnappingContext(t){var i;const n=this._drawAtFixedElevation?(i=this.elevationDrawSurface)==null?void 0:i.defaultZ:null;return new Qt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:t,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:n!=null?{value:n,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function qo(e,t,n){const i=e.x-t.x,o=e.y-t.y;return i*i+o*o<=n}c([p()],g.prototype,"_hideDefaultCursor",void 0),c([p()],g.prototype,"_stagedPointerId",void 0),c([p()],g.prototype,"_isDragging",null),c([p()],g.prototype,"_snappingOperation",void 0),c([p()],g.prototype,"_snappingEnabled",null),c([p({constructOnly:!0})],g.prototype,"graphic",void 0),c([p()],g.prototype,"constraintsEnabled",void 0),c([p()],g.prototype,"constraints",void 0),c([p()],g.prototype,"_constraint",null),c([p()],g.prototype,"constraintZ",void 0),c([p()],g.prototype,"defaultZ",void 0),c([p()],g.prototype,"isDraped",void 0),c([p({value:gn})],g.prototype,"drawingMode",null),c([p({constructOnly:!0})],g.prototype,"elevationDrawSurface",void 0),c([p({constructOnly:!0})],g.prototype,"elevationInfo",void 0),c([p({constructOnly:!0,type:nn})],g.prototype,"labelOptions",void 0),c([p({constructOnly:!0})],g.prototype,"geometryType",void 0),c([p({constructOnly:!0})],g.prototype,"hasM",void 0),c([p({constructOnly:!0})],g.prototype,"hasZ",void 0),c([p()],g.prototype,"cursor",void 0),c([p()],g.prototype,"effectiveCursor",null),c([p()],g.prototype,"loading",void 0),c([p({constructOnly:!0})],g.prototype,"manipulators",void 0),c([p({constructOnly:!0})],g.prototype,"drawSurface",void 0),c([p({constructOnly:!0})],g.prototype,"segmentLabels",void 0),c([p({constructOnly:!0})],g.prototype,"snappingManager",void 0),c([p({constructOnly:!0})],g.prototype,"snappingVisualizer",void 0),c([p()],g.prototype,"snapToSceneEnabled",void 0),c([p({readOnly:!0})],g.prototype,"cursorVertex",null),c([p({readOnly:!0})],g.prototype,"visualizationCursorVertex",null),c([p()],g.prototype,"committableVertex",null),c([p()],g.prototype,"firstVertex",void 0),c([p()],g.prototype,"lastVertex",void 0),c([p()],g.prototype,"secondToLastVertex",void 0),c([p()],g.prototype,"updating",null),c([p({constructOnly:!0})],g.prototype,"view",void 0),g=c([O("esri.views.draw.DrawOperation")],g);class Fs{constructor(t,n,i,o=null){this._elevationInfo=t,this.defaultZ=n,this._view=i,this._excludeGraphics=o}screenToMap(t){const{defaultZ:n,_view:i}=this,o=i.sceneIntersectionHelper.intersectElevationFromScreen(Kn(t.x,t.y),this._elevationInfo,n??0,this._excludeGraphics);return n==null&&o!=null&&(o.z=void 0),o}mapToScreen(t){const n=oe(t.x,t.y,Be(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(n)}constrainZ(t){const{defaultZ:n}=this;return n!=null&&t.z!==n&&((t=kt(t)).z=n),t}}class Gs{constructor(t,n,i=[]){this.view=t,this.elevationInfo=n,this.exclude=i}screenToMap(t){const n=this.view.toMap(t,{exclude:this.exclude,excludeLabels:!0});return n!=null&&(n.z=Pt(n,this.view,this.elevationInfo)),n}mapToScreen(t){let n=t;return this.elevationInfo!=null&&(n=oe(t.x,t.y,Be(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(n)}constrainZ(t){return t}}let Hs=class{constructor(t,n=!1,i=0){this.view=t,this.hasZ=n,this.defaultZ=i,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=n?o=>{const s=t.toMap(o);return s.z=i,s}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:n}=this;return this.hasZ&&t.z!==n&&((t=kt(t)).z=n),t}};new Ge;function Zs(e,t){return vn(e,t,!1)}function Ls(e,t){return vn(e,t,!0)}function vn(e,t,n){if(e instanceof Ti){if(e.operation instanceof Mi)return Bo(e.operation,t,n),!0;if(e.operation instanceof Oi)return Yo(e.operation,t,n),!0;if(e.operation instanceof Pi)return Xo(e.operation,t,n),!0}return!1}function Bo(e,t,n=!1){const i=n?-1:1,o=ni(i*e.dx,i*e.dy,i*e.dz);Mt(t.origin,t.origin,o),It(t)}function Yo(e,t,n=!1){const i=n?-e.angle:e.angle;ye(t.basis1,t.basis1,fe,i),ye(t.basis2,t.basis2,fe,i),It(t)}function Xo(e,t,n=!1){const i=n?1/e.factor1:e.factor1,o=n?1/e.factor2:e.factor2;jt(t.basis1,t.basis1,i),jt(t.basis2,t.basis2,o),ve(t.origin,t.origin,e.origin,e.axis1,i),ve(t.origin,t.origin,e.origin,e.axis2,o),It(t)}function Ws(e,t,n,i,o=!1){i||(i=Di());const s=it(ot.get(),e[1],-e[0]),a=it(ot.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=it(ot.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),r=ot.get(),u=t.allVertices;u.forEach(({pos:h})=>{it(r,me(e,h),me(s,h)),Qn(a,a,r),Jn(l,l,r)});const d=1e-6,m=it(ot.get(),l[0]-a[0]<d?n/2:0,l[1]-a[1]<d?n/2:0);ti(a,a,m),ei(l,l,m);const v=o?u.reduce((h,_)=>h+(_.pos[2]??0),0)/u.length:0;return ge(i.basis1,e,(l[0]-a[0])/2),ge(i.basis2,s,(l[1]-a[1])/2),Fe(i.origin,a[0]*e[0]+a[1]*s[0],a[0]*e[1]+a[1]*s[1],v),Mt(i.origin,i.origin,i.basis1),Mt(i.origin,i.origin,i.basis2),It(i),i}export{Fo as D,Cs as E,g as F,w as I,Ps as M,Ws as S,Ls as T,zs as U,Zs as V,As as a,Rs as b,Fs as c,Go as d,Io as f,zo as g,Hs as h,Is as j,Gs as l,Es as m,S as n,Lt as p,Vs as v,dt as w,ks as z};
