import{g6 as V,dZ as y,g7 as s}from"./index-occlv2kq.js";import{a as b}from"./CIMSymbolHelper-DYMZVHfw.js";import{CIMSymbolRasterizer as $}from"./CIMSymbolRasterizer-DDkIP0y7.js";import{y as q}from"./OverrideHelper-DzamvxWf.js";import{l as D,t as S}from"./symbolUtils-nl5FwhcI.js";import"./BidiEngine-QXap_35O.js";import"./fontUtils-CprKnufC.js";import"./OptimizedGeometry-CjBBEGP9.js";import"./memoryEstimations-BOKhmi2n.js";import"./GeometryUtils-DwKZSSX8.js";import"./rasterizingUtils-OfFRwl_W.js";import"./floatRGBA-Bk0JGNMV.js";import"./Rect-CUzevAry.js";import"./BoundingBox-BVS6mmAT.js";import"./CIMResourceManager-BwPxQXqP.js";import"./colorUtils-BE9EAhAp.js";import"./quantizationUtils-BzPu5BSx.js";import"./utils-BAWMos0e.js";import"./utils-WwdkQDBe.js";import"./cimSymbolUtils-D6S5Cezv.js";import"./webStyleSymbolUtils-Nuz-hEei.js";import"./devEnvironmentUtils-CnNDiFMM.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";const g=new $(null),u=s(S.size),G=s(S.maxSize),M=s(S.lineWidth),E=1;async function U(r,e,m){const i=e==null?void 0:e.size;let t=i!=null&&typeof i=="object"&&"width"in i?i.width:i,a=i!=null&&typeof i=="object"&&"height"in i?i.height:i;if(t==null||a==null)if(m==="esriGeometryPolygon")t=a=e.maxSize?Math.min(e.maxSize,u):u;else{const o=await k(r,e,m);o&&(t=o.width,a=o.height),m==="esriGeometryPolyline"&&(t=e.maxSize?Math.min(e.maxSize,M):M),t=t!=null&&isFinite(t)?Math.min(t,G):u,a=a!=null&&isFinite(a)?Math.max(Math.min(a,G),E):u}return e.style==="legend"&&m==="esriGeometryPolyline"&&(t=M),{width:t,height:a}}async function k(r,e,m){const{feature:i,fieldMap:t,viewParams:a}=e.cimOptions||e,o=await q.resolveSymbolOverrides(r.data,i,null,t,m,null,a);if(!o)return null;(r=r.clone()).data={type:"CIMSymbolReference",symbol:o},r.data.primitiveOverrides=void 0;const l=[];return b.fetchResources(o,g.resourceManager,l),b.fetchFonts(o,g.resourceManager,l),l.length>0&&await Promise.all(l),b.getEnvelope(o,null,g.resourceManager)}async function he(r,e={}){var z,P;const{node:m,opacity:i,symbolConfig:t}=e,a=t!=null&&typeof t=="object"&&"isSquareFill"in t&&t.isSquareFill,o=e.cimOptions||e,l=o.geometryType||V((z=r==null?void 0:r.data)==null?void 0:z.symbol),n=await U(r,e,l),{feature:I,fieldMap:L}=o,F=e!=null&&e.geometry||a||l!=="esriGeometryPolygon"?"preview":"legend";let v=n;const x=n;if(e!=null&&e.geometry&&(l==="esriGeometryPolygon"||l==="esriGeometryPolyline")&&(y(n.width)<200||y(n.height)<200)){const R=n.width>n.height?s(200)*n.height/n.width:s(200);v={width:n.width>n.height?s(200):s(200)*n.width/n.height,height:R}}const f=await g.rasterizeCIMSymbolAsync(r,I,v,F,L,l,null,o.viewParams,o.allowScalingUp,(P=e==null?void 0:e.geometry)==null?void 0:P.toJSON());if(!f)return null;const{width:O,height:j}=f,c=document.createElement("canvas");c.width=O,c.height=j,c.getContext("2d").putImageData(f,0,0);const d=y(x.width),w=y(x.height),h=new Image(d,w);h.src=c.toDataURL(),h.ariaLabel=e.ariaLabel??null,h.alt=e.ariaLabel??"",i!=null&&(h.style.opacity=`${i}`);let p=h;if(e.effectView!=null){const C={shape:{type:"image",x:0,y:0,width:d,height:w,src:h.src},fill:null,stroke:null,offset:[0,0]};p=D([[C]],[d,w],{effectView:e.effectView,ariaLabel:e.ariaLabel})}return m&&p&&m.appendChild(p),p}export{he as previewCIMSymbol};
