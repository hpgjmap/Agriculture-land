import{gv as F,hx as A,ge as O,hy as Y,gj as H,gQ as Q,hz as J,h0 as K,g1 as S,hA as N,gb as R,gP as W,g2 as Z,gf as ee,g7 as te,gd as se,g4 as ne,hB as oe}from"./index-CQBquChn.js";function M(){return{m_pGcs:new S,m_xyz:new N,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:re,setLength:ae,assign:ie}}function re(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function ae(i){this.m_geoLength=i}function ie(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ce{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new F().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let m=90,r=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,r*=Math.PI/180),t.getCoordinateSystemType()===2){let _=null;const o=[0,0,0,0];_=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=r,A.geogToProj(_,2,o),m=o[1],r=o[3]}const c=new O;e.queryEnvelope(c),c.ymin=r,c.ymax=m,e=new Y().execute(e,c,t,s)}else{const m=t.getPCSHorizon();(e=new H().execute(e,m,t,s))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,m){const r=Q();n.querySpheroidData(r);const c=r.majorSemiAxis,_=r.e2,o=n.getUnit().getUnitToBaseFactor(),T=40,C=J(M,T),P=K(T,Number.NaN),f=M(),g=M();let y;const a=[0,0,0,0],U=t.getPECoordSys(),E=new S,L=new S,l=new S,p=new S,d=new S;let V=0;const v=e.querySegmentIterator();for(;v.nextPath();)for(;v.hasNextSegment();){const z=v.nextSegment();E.assign(z.getStartXY()),L.assign(z.getEndXY()),t.getCoordinateSystemType()===2?(a[0]=E.x,a[1]=E.y,a[2]=L.x,a[3]=L.y,A.projToGeog(U,2,a),l.x=a[0]*o,l.y=a[1]*o,p.x=a[2]*o,p.y=a[3]*o):(l.setCoordsPoint2D(E),p.setCoordsPoint2D(L),l.scale(o),p.scale(o));const D=new N,j=new N;q(c,_,l,D),q(c,_,p,j);let x=b(c,D,j);f.setValues(0,l,Number.NaN,D),g.setValues(1,p,x,j),y=s,C[0].assign(g),P[0]=s;let h=0;for(;;){h>128&&ne("iterations exceeded");const B=.5*(f.m_factor+g.m_factor),I=z.getCoord2D(B);t.getCoordinateSystemType()===2?(a[0]=I.x,a[1]=I.y,A.projToGeog(U,1,a),d.x=a[0]*o,d.y=a[1]*o):(d.setCoordsPoint2D(I),d.scale(o)),l.setCoordsPoint2D(f.m_pGcs),p.setCoordsPoint2D(g.m_pGcs);const G=new N;q(c,_,d,G);const X=b(c,f.m_xyz,G),$=b(c,g.m_xyz,G);x=g.m_geoLength,Number.isNaN(x)&&(x=b(c,f.m_xyz,g.m_xyz));const w=X+$,k=y===s&&w>=20&&Math.abs(w-x)>1e-8*(x+w);if(h+2<T&&(k||Math.abs(w-x)>0&&y>0))g.setLength($),C[h].assign(g),g.setValues(B,d,X,G),C[++h].assign(g),k?(y=s,P[h]=s):(y--,P[h-1]=y,P[h]=y);else{if(V+=w,h===0)break;f.assign(g),g.assign(C[--h]),y=P[h]}}}return V}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||R(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const s=t.getGCS();s!==t&&(u=W(t,s,null));const m=e.getGeometryType();if(m===Z.enumEnvelope){const r=new ee;return r.addEnvelope(e,!1),this._ExecuteShapePreservingLength(r,t,s,u,n)}if(te(m)){const r=new se;return r.addSegment(e,!0),this._ExecuteShapePreservingLength(r,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}}function q(i,e,t,n){n.assign(oe(i,e,t))}function b(i,e,t){const n=i,u=new N;u.setSub(e,t);const s=u.length();return 2*n*Math.asin(s/(2*n))}export{ce as w};
